(function(n,i){typeof exports=="object"&&typeof module!="undefined"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis!="undefined"?globalThis:n||self,i(n.VuePrintNext={}))})(this,function(n){"use strict";var A=Object.defineProperty,k=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var g=(n,i,d)=>i in n?A(n,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):n[i]=d,b=(n,i)=>{for(var d in i||(i={}))B.call(i,d)&&g(n,d,i[d]);if(w)for(var d of w(i))C.call(i,d)&&g(n,d,i[d]);return n},x=(n,i)=>k(n,T(i));var E=(n,i)=>{var d={};for(var y in n)B.call(n,y)&&i.indexOf(y)<0&&(d[y]=n[y]);if(n!=null&&w)for(var y of w(n))i.indexOf(y)<0&&C.call(n,y)&&(d[y]=n[y]);return d};var f=(n,i,d)=>g(n,typeof i!="symbol"?i+"":i,d);const i="[VuePrintNext]";class d{constructor(e){f(this,"standards",{strict:"strict",loose:"loose",html5:"html5"});f(this,"iframeId","");f(this,"previewBody",null);f(this,"close",null);f(this,"counter",0);f(this,"settings");const t=e.vue,p=e,{standard:r,zIndex:s,previewTitle:o,previewPrintBtnLabel:l,preview:a,popTitle:u}=p,v=E(p,["standard","zIndex","previewTitle","previewPrintBtnLabel","preview","popTitle"]);this.settings=x(b({standard:r||"html5",zIndex:s||20002,previewTitle:o||"打印预览",previewPrintBtnLabel:l||"打印",preview:a||!1,popTitle:u||document.title},v),{previewBeforeOpenCallback(){var c;(c=e.previewBeforeOpenCallback)==null||c.call(e,t)},previewOpenCallback(){var c;(c=e.previewOpenCallback)==null||c.call(e,t)},openCallback(){var c;(c=e.openCallback)==null||c.call(e,t)},closeCallback(){var c;(c=e.closeCallback)==null||c.call(e,t)},beforeOpenCallback(){var c;(c=e.beforeOpenCallback)==null||c.call(e,t)}}),this.init()}init(){this.counter++,this.iframeId=`printArea_${this.counter}`;const{el:e,url:t}=this.settings;if(e||t){const r=e?"":t||"",s=this.getPrintWindow(r);e&&this.write(s.doc),this.settings.preview?this.previewIframeLoad():this.print(s);return}if(this.settings.asyncUrl){this.settings.asyncUrl(r=>{const s=this.getPrintWindow(r);this.settings.preview?this.previewIframeLoad():this.print(s)},this.settings.vue);return}throw new Error(`${i}: Either "el"、"url" or "asyncUrl" parameter must be provided in the settings.`)}addEvent(e,t,r){e&&(e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r)}previewIframeLoad(){var r,s;const e=document.getElementById("vue-pirnt-next-previewBox");if(!e)return;const t=e.querySelector("iframe");(s=(r=this.settings).previewBeforeOpenCallback)==null||s.call(r),this.addEvent(t,"load",()=>{var o,l;this.previewBoxShow(),(l=(o=this.settings).previewOpenCallback)==null||l.call(o)}),this.addEvent(e.querySelector(".previewBodyUtilPrintBtn"),"click",()=>{var o,l,a,u,v,p,c;(l=(o=this.settings).beforeOpenCallback)==null||l.call(o),(u=(a=this.settings).openCallback)==null||u.call(a),(v=t==null?void 0:t.contentWindow)==null||v.print(),(c=(p=this.settings).closeCallback)==null||c.call(p)})}print(e){var o,l;const t=document.getElementById(this.iframeId)||e.f,r=t==null?void 0:t.contentWindow;if(!r)return;const s=()=>{const a=setTimeout(()=>{var u,v,p,c;r.focus(),(v=(u=this.settings).openCallback)==null||v.call(u),r.print(),t.remove(),(c=(p=this.settings).closeCallback)==null||c.call(p),clearTimeout(a)})};(l=(o=this.settings).beforeOpenCallback)==null||l.call(o),this.addEvent(t,"load",s)}getNoPrintMediaStyle(){const e=this.settings.noPrintSelector;return e?!Array.isArray(e)&&!(typeof e=="string")?(console.error(new TypeError(`${i}: The "noPrintSelector" must be either a string or an array of strings. Please check your settings.`)),""):`${(Array.isArray(e)?e:[e]).filter(l=>l.trim()).join(",")} { display: none; }`:""}write(e){e.open(),e.write(`${this.docType()}<html lang='zh'>${this.getHead()}${this.getBody()}</html>`),e.close()}docType(){if(this.settings.standard===this.standards.html5)return"<!DOCTYPE html>";const e=this.settings.standard===this.standards.loose?" Transitional":"",t=this.settings.standard===this.standards.loose?"loose":"strict";return`<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01${e}//EN" "http://www.w3.org/TR/html4/${t}.dtd">`}getPrintMediaStyle(){return"body {-webkit-print-color-adjust: exact; -moz-print-color-adjust: exact; -ms-print-color-adjust: exact; print-color-adjust: exact;}"}getHead(){const e=(this.settings.extraHead||"").split(",").filter(a=>a.length>0).join(""),t=Array.from(document.querySelectorAll("link")).filter(a=>a.href.includes(".css")).map(a=>`<link type="text/css" rel="stylesheet" href='${a.href}'>`).join(""),r=Array.from(document.querySelectorAll("style")).map(a=>a.outerHTML).join(""),s=(this.settings.extraCss||"").split(",").filter(a=>a.trim().length>0).map(a=>`<link type="text/css" rel="stylesheet" href='${a.trim()}'>`).join(""),o=this.getPrintMediaStyle(),l=this.getNoPrintMediaStyle();return`<head>
							<title>${this.settings.popTitle}</title>
							${e}${t}
							${r}
							<style type="text/css">${l}${o}</style>
							${s}
						</head>`}getPrintAreaDom(){const e=this.settings.el,t=typeof e=="string";if(e instanceof HTMLElement)return[e];if(!t)throw new TypeError(`${i}: The "el" property should be either a string (CSS selector) or an HTMLElement, but received type "${typeof e}".`);let r=Array.from(document.querySelectorAll(e));if(!(r!=null&&r.length))throw new Error(`${i}: No elements found matching the selector: "${e}".`);return r}getBody(){const e=this.getPrintAreaDom(),t=document.createElement("div");return e.forEach(r=>{const s=r.cloneNode(!0);this.removeScriptHandler(s),this.canvasToImgHandler(r,s),this.formDataHandler(r,s),t.appendChild(s)}),`<body>${t.innerHTML}</body>`}removeScriptHandler(e){e.querySelectorAll("script").forEach(r=>{r.remove()})}canvasToImgHandler(e,t){const r=e.querySelectorAll("canvas");t.querySelectorAll("canvas").forEach((o,l)=>{const a=r[l],u=o.parentNode,v=a.toDataURL("image/png"),p=new Image;p.className="canvasImg",p.style.display="block",p.src=v,u==null||u.appendChild(p),o.remove()})}formDataHandler(e,t){const r=t.querySelectorAll("input,select,textarea");let s=-1;r.forEach(o=>{var u;const l=o.value;switch((u=o.getAttribute("type"))!=null?u:o.tagName.toLowerCase()){case"select":s++;const v=e.querySelectorAll("select")[s];if(v){const p=v.selectedIndex;o.options[p].setAttribute("selected","selected")}break;case"textarea":o.innerHTML=l,o.setAttribute("html",l);break;case"radio":case"checkbox":o.checked&&o.setAttribute("checked","checked");break;default:o.value=l,o.setAttribute("value",l);break}})}getPrintWindow(e){var s;const t=this.createIframe(e),r=t.contentDocument||((s=t.contentWindow)==null?void 0:s.document)||t.document;if(!r)throw new Error(`${i}: Unable to find the document object within the created iframe. Please ensure the iframe is correctly created and loaded.`);return{f:t,win:t.contentWindow||t,doc:r}}previewBoxShow(){var t;const e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: hidden"),e.style.display="block")}previewBoxHide(){var t,r;const e=document.getElementById("vue-pirnt-next-previewBox");e&&((t=document.querySelector("html"))==null||t.setAttribute("style","overflow: visible;"),(r=e.querySelector("iframe"))==null||r.remove(),e.style.display="none")}previewBox(){var r;let e=document.getElementById("vue-pirnt-next-previewBox");if(e)return(r=e.querySelector("iframe"))==null||r.remove(),{close:e.querySelector(".previewClose"),previewBody:e.querySelector(".previewBody")};e=document.createElement("div"),e.setAttribute("id","vue-pirnt-next-previewBox"),e.setAttribute("style","position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; background: white; display: none; z-index: "+this.settings.zIndex);const t=document.createElement("div");return t.setAttribute("class","previewHeader"),t.setAttribute("style","padding: 5px 20px;"),t.innerHTML=this.settings.previewTitle||"",this.close=this.createCloseButton(),t.appendChild(this.close),e.appendChild(t),this.previewBody=this.createPreviewBody(),e.appendChild(this.previewBody),document.body.appendChild(e),{close:this.close,previewBody:this.previewBody}}createIframe(e){const t=document.createElement("iframe");if(t.id=this.iframeId,t.src=e||new Date().getTime().toString(),t.style.display="none",!this.settings.preview)document.body.appendChild(t);else{t.setAttribute("style","border: 0px; flex: 1;");const{close:r,previewBody:s}=this.previewBox();s&&s.appendChild(t),this.addEvent(r,"click",this.previewBoxHide.bind(this))}return t}createCloseButton(){const e=document.createElement("div");e.setAttribute("class","previewClose"),e.setAttribute("style","position: absolute; top: 5px; right: 20px; width: 25px; height: 20px; cursor: pointer;");const t=document.createElement("div"),r=document.createElement("div"),s="position: absolute; width: 3px; height: 100%; background: #040404; top: 0px; left: 50%;";return t.setAttribute("class","closeBefore"),t.setAttribute("style",`${s} transform: rotate(45deg);`),r.setAttribute("class","closeAfter"),r.setAttribute("style",`${s} transform: rotate(-45deg);`),e.appendChild(t),e.appendChild(r),e}createPreviewBody(){const e=document.createElement("div");e.className="previewBody",e.style.cssText="display: flex; flex-direction: column; height: 100%;";const t=document.createElement("div");t.className="previewBodyUtil",t.style.cssText="height: 32px; background: #474747; position: relative;";const r=document.createElement("div");return r.className="previewBodyUtilPrintBtn",r.style.cssText="position: absolute; padding: 2px 10px; margin-top: 3px; left: 24px; font-size: 14px; color: white; cursor: pointer; background: rgba(0,0,0,.12); border: 1px solid rgba(0,0,0,.35); box-shadow: inset 0 1px 0 hsla(0,0%,100%,.05), inset 0 0 1px hsla(0,0%,100%,.15);",r.innerHTML=this.settings.previewPrintBtnLabel||"",t.appendChild(r),e.appendChild(t),e}}const y=(h,e,t)=>{h.addEventListener?h.addEventListener(e,t,!1):h.attachEvent?h.attachEvent("on"+e,t):h["on"+e]=t},m={directiveName:"print",mounted(h,e){let t,r={};y(h,"click",()=>{e.value?typeof e.value=="string"?t=e.value:typeof e.value=="object"&&(t=e.value.el,r=e.value):t="body",new d(x(b({},r),{el:t,vue:e.instance}))})},bind(h,e,t){e.instance=t.context,m.mounted(h,e)}},S={install(h){h.directive(m.directiveName,m)}};n.VuePrintNext=d,n.printPlugin=S,n.vPrint=m,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
